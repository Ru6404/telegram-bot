from flask import Flask, request, jsonify
from flask_cors import CORS
import random
from datetime import datetime

app = Flask(__name__)
CORS(app)

@app.route('/api/ai/ask', methods=['POST'])
def aski():
    try:
        data = request.json
        question = data.get('question', '').lower()
        user_context = data.get('context', '')
        
        print(f"üì® –ü–æ–ª—É—á–µ–Ω –≤–æ–ø—Ä–æ—Å: {question}")
        print(f"üë§ –ö–æ–Ω—Ç–µ–∫—Å—Ç: {user_context}")
        
        # –£–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–æ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω
        if '—É–∑–±–µ–∫' in question:
            if '–Ω–æ–≤–æ—Å—Ç–∏' in question:
                news_responses = [
                    "üá∫üáø –ù–æ–≤–æ—Å—Ç–∏ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞: –≠–∫–æ–Ω–æ–º–∏–∫–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 5.8% –≤ —ç—Ç–æ–º –≥–æ–¥—É, —Ç—É—Ä–∏–∑–º —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 30%",
                    "üì∞ –¢–∞—à–∫–µ–Ω—Ç: –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –ø—Ä–∏–≤–ª–µ–∫–ª–∞ $7.8 –º–ª—Ä–¥",
                    "üåè –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω: –ó–∞–ø—É—â–µ–Ω–∞ –Ω–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ —Å –±—é–¥–∂–µ—Ç–æ–º $500 –º–ª–Ω",
                    "üöÄ –°–∞–º–∞—Ä–∫–∞–Ω–¥: –§–µ—Å—Ç–∏–≤–∞–ª—å –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è —Å–æ–±—Ä–∞–ª —Ä–µ–∫–æ—Ä–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É—Ä–∏—Å—Ç–æ–≤",
                    "üíº –≠–∫–æ–Ω–æ–º–∏–∫–∞: –†–æ—Å—Ç –í–í–ü –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 5.8%, –∏–Ω—Ñ–ª—è—Ü–∏—è - 10.2%"
                ]
                return jsonify({"answer": random.choice(news_responses)})
            
            elif '–∏–∑–º–µ–Ω–µ–Ω–∏—è' in question or '—Ä–µ—Ñ–æ—Ä–º—ã' in question:
                reform_responses = [
                    "üîç –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ: –¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è 90% –≥–æ—Å—É—Å–ª—É–≥, —É–ø—Ä–æ—â–µ–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã",
                    "üì± –†–µ—Ñ–æ—Ä–º—ã: –ó–∞–ø—É—Å–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã my.gov.uz –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥",
                    "üå± –ó–µ–ª–µ–Ω–∞—è —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –∏ –≤–µ—Ç—Ä—è–Ω—ã—Ö —ç–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü–∏–π",
                    "üèõÔ∏è –ì–æ—Å—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–µ—Ñ–æ—Ä–º–∞ –∏ –±–æ—Ä—å–±–∞ —Å –∫–æ—Ä—Ä—É–ø—Ü–∏–µ–π",
                    "üí∏ –≠–∫–æ–Ω–æ–º–∏–∫–∞: –õ–∏–±–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞ –∏ –ø—Ä–∏–≤–∞—Ç–∏–∑–∞—Ü–∏—è –≥–æ—Å–ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π"
                ]
                return jsonify({"answer": random.choice(reform_responses)})
            
            else:
                uzbek_responses = [
                    "üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω - —Å—Ç—Ä–∞–Ω–∞ —Å –±–æ–≥–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–∏–≤–∞—é—â–µ–π—Å—è —ç–∫–æ–Ω–æ–º–∏–∫–æ–π!",
                    "üåè –°—Ç–æ–ª–∏—Ü–∞ –¢–∞—à–∫–µ–Ω—Ç - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–≥–∞–ø–æ–ª–∏—Å —Å –Ω–∞—Å–µ–ª–µ–Ω–∏–µ–º 2.5 –º–ª–Ω —á–µ–ª–æ–≤–µ–∫",
                    "üé≠ –ö—É–ª—å—Ç—É—Ä–∞: –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–∏–º–∏ –¥—Ä–µ–≤–Ω–∏–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏ –®–µ–ª–∫–æ–≤–æ–≥–æ –ø—É—Ç–∏",
                    "üèîÔ∏è –ì–µ–æ–≥—Ä–∞—Ñ–∏—è: –û—Ç –≥–æ—Ä –¢—è–Ω—å-–®–∞–Ω—è –¥–æ –ø—É—Å—Ç—ã–Ω–∏ –ö—ã–∑—ã–ª–∫—É–º",
                    "üìà –≠–∫–æ–Ω–æ–º–∏–∫–∞: –ë—ã—Å—Ç—Ä–æ—Ä–∞—Å—Ç—É—â–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ç—É—Ä–∏–∑–º –∏ IT"
                ]
                return jsonify({"answer": random.choice(uzbek_responses)})
        
        # –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
        if '—á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å' in question:
            return jsonify({"answer": "ü§ñ –Ø –º–æ–≥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ, –ø–æ–º–æ–≥–∞—Ç—å —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ! –°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ —á–µ–º —É–≥–æ–¥–Ω–æ!"})
        
        if '–ø—Ä–∏–≤–µ—Ç' in question or 'hello' in question:
            return jsonify({"answer": "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫. –ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å!"})
        
        # –£–º–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç
        responses = [
            f"ü§î –ü–æ –≤–∞—à–µ–º—É –≤–æ–ø—Ä–æ—Å—É '{question}': —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞! –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
            f"üí° '{question}' - —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, —É—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏?",
            f"üéØ –ü–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å –ø—Ä–æ '{question}'. –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è?",
            f"üîç –ò–∑—É—á–∞—é –≤–æ–ø—Ä–æ—Å '{question}'. –ö–∞–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ãÊúÄÈáçË¶Å?",
            f"üöÄ –ü—Ä–∏–Ω—è–ª! –ü–æ —Ç–µ–º–µ '{question}' –µ—Å—Ç—å –º–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"
        ]
        
        return jsonify({"answer": random.choice(responses)})
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return jsonify({"answer": "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."})

@app.route('/health', methods=['GET'])
def health_check():
    return jsonify({"status": "ok", "message": "AI Service is running", "timestamp": datetime.now().isoformat()})

if __name__ == '__main__':
    print("üöÄ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ò–ò-—Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5000...")
    app.run(host='0.0.0.0', port=5000, debug=True)
